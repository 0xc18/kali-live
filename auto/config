#!/bin/sh

# Various comments
# live-build doesn't work if --parent-debian-distribution is unknown of
# debian-cd => we have to put a symlink so that it deals with kali like wheezy

if [ ! -e /usr/share/live/build/data/debian-cd/kali ]; then
       echo "ERROR: Run this first"
       echo "ln -sf wheezy /usr/share/live/build/data/debian-cd/kali"
       exit 1
fi

kali_mirror=http://repo.kali.org/kali
kalisec_mirror=http://repo.kali.org/security

lb config noauto \
	--distribution "kali" \
	--debian-installer-distribution "kali" \
	--archive-areas "main contrib non-free" \
	--bootstrap cdebootstrap \
	--cdebootstrap-options "--keyring=/usr/share/keyrings/kali-archive-keyring.gpg --suite-config=wheezy" \
	--keyring-packages kali-archive-keyring \
	--updates false \
	--backports false \
	--source false \
	--firmware-binary true \
	--firmware-chroot true \
	--mirror-bootstrap $kali_mirror \
	--mirror-debian-installer $kali_mirror \
	--mirror-chroot-security $kalisec_mirror \
	--mirror-binary $kali_mirror \
	--mirror-binary-security $kalisec_mirror \
	--iso-application "Kali Linux" \
	--iso-publisher "Kali" \
	--iso-volume "Kali Live" \
	--linux-packages linux-image \
	--bootappend-live "boot=live config live-config.username=root hostname=kali" \
	"$@"
